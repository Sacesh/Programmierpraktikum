#!/usr/bin/perl -w
use strict;

#TODO input check

#counting helix and sheets
my $helix = 0;
my $sheet = 0;
#count aminoacis and aminoacids in secondary structure
my $amino = 0;
my $secon = 0;
#hashmap to keep track of the atoms that are part of secondary structures
my %hash = ();
#keeping track of extrem coordinates
my $posx = '-inf';
my $negx = '+inf';
my $posy = '-inf';
my $negy = '+inf';
my $posz = '-inf';
my $negz = '+inf';
#keeping track of first CA-CB pair
my $firstCAx;
my $firstCAy;
my $firstCAz;
my $firstCBx;
my $firstCBy;
my $firstCBz;
my $firstupdatea = 0;
my $firstupdateb = 0;
#keeping track of last CA-CB pair
my $lastCAx;
my $lastCAy;
my $lastCAz;
my $lastCBx;
my $lastCBy;
my $lastCBz;
my $lastupdatea = 0;
my $lastupdateb = 0;




#extracting information from input file
while(<>){
my $m = $_;
    if( $m =~ m/^HELIX/ ){
	$helix++;
	#marking Atom numbers for counting amino acids in secondary structure
	my $hestart = substr ($m,20,5);
	my $hestop = substr ($m,32,5);
	foreach ($hestart .. $hestop){
	   $hash{ $_ } = '1';
	}
    }
    if( $m =~ m/^SHEET/ ){
	$sheet++;
	#marking Atom numbers for counting amino acids in secondary structure
	my $shstart = substr ($m,22,4);
	my $shstop = substr ($m,33,4);
	foreach ($shstart .. $shstop){
	   $hash{ $_ } = '1';
	}
    }
    if( $m =~ m/^ATOM/ ){
	if( $m =~ /^.{13}CA/ ){
	    $amino++;
	    if(exists $hash{substr($m,22,4)*1.0}){
		$secon++;
	    }
	    if (!defined $firstCAx){
		$firstCAx = substr($m,32,6);
		$firstCAy = substr($m,40,6);
		$firstCAz = substr($m,48,6);
		$lastCAx = substr($m,32,6);
		$lastCAy = substr($m,40,6);
		$lastCAz = substr($m,48,6);
	    }
        }
	#check for new extreme coordinates
	my $subx = substr($m,32,6);
	    if($subx >= $posx){
		$posx = $subx;
	    }
	    if($subx <= $negx){
		$negx = $subx;
	    }
	my $suby = substr($m,40,6);
	    if($suby >= $posy){
		$posy = $suby;
	    }
	    if($suby <= $negy){
		$negy = $suby;
	    }
	my $subz = substr($m,48,6);
	    if($subz >= $posz){
		$posz = $subz;
	    }
	    if($subz <= $negz){
		$negz = $subz;
	    } 
    }         
}

print $helix," helix found \n";
print $sheet," sheets found \n";

print $amino," amino acis found \n";
print $secon," amino acis in secondary structure \n";
if ($amino != 0){
my $percentage = ($secon / $amino) * 100;
print $percentage, "% of the amino acids are part of secondary structures\n";
}

print $posx," pos x \n";
print $negx," nos x \n";

#TODO return result

